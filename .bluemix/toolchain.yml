version: 2
messages:
  $i18n: locales.yml
template:
  name:
    $ref: "#/messages/template.name"
  description:
    $ref: "#/messages/template.description"
  required:
    - githubconsolidated01
    - pipeline_bootstrap
    - pipeline_vsi
  $configuration:
     ENABLE_EXTENSIONS: true
     ENABLE_IF_ELSE: true
     EXPRESSION_MAXLENGTH: 1000
  info:
    git url: >
      "[" + $env.repository + "]" +
        "(" + $env.repository + ")"
    git branch: >
      "[" + $env.branch + "]" +
        "(" + $env.repository +
          "/tree/" + $env.branch + ")"
toolchain:
  name: AC-Automation
services:
  pipeline_bootstrap:
    parameters:
      label: pipeline01-bootstrap
      type: tekton
      name: pipeline01-bootstrap
      ui_pipeline: true
      configuration:
        env:
          githubconsolidated01: githubconsolidated01
          PIPELINE_REPO: '$env.repository'
          PIPELINE_REPO_BRANCH: '$env.branch'
          API_KEY: '{{form.pipeline.parameters.api-key}}'
          VAR_FILE: '{{form.pipeline.parameters.tf-var-file}}'
        content:
          $text: pipeline_bootstrap.yml
      services:
        - githubconsolidated01
    service_id: pipeline

  pipeline_vsi:
    parameters:
      label: pipeline04-vsi
      type: tekton
      name: pipeline04-vsi
      ui_pipeline: true
      configuration:
        env:
          githubconsolidated01: githubconsolidated01
          PIPELINE_REPO: '$env.repository'
          PIPELINE_REPO_BRANCH: '$env.branch'
          API_KEY: '{{form.pipeline.parameters.api-key}}'
          VAR_FILE: '{{form.pipeline.parameters.tf-var-file}}'
        content:
          $text: pipeline_vsi.yml
      services:
        - githubconsolidated01
    service_id: pipeline

  githubconsolidated01:
    parameters:
      extra_capabilities:
        - capability_id: git.issues
          display_name: Issues
          dashboard_url: ''
          label: ac-automation
          tags:
            - think
            - code
          enabled: false
          readme: false
      label: ac-automation
      type: link
      legal: true
      owner_id: fs-cloud-canada
      repo_url: '$env.repository'
      private_repo: true
      has_issues: false
      enable_traceability: true
      integration_owner: '****'
      repo_name: ac-automation
      api_root_url: '****'
      token_url: '****'
    service_id: githubconsolidated

  draservicebroker02:
    parameters:
      cf_controller: '****'
      dra_server: '****'
      dlms_server: '****'
      dashboard_url: '****'
      env_id: '****'
    service_id: draservicebroker
form:
  pipeline:
    parameters:
      app-name: '{{services.githubconsolidated01.parameters.repo_name}}'
      api-key: ''
      tf-var-file: 'devtest.tfvars'
    schema:
      $ref: deploy.json
